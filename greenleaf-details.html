<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GreenLeaf Living - Details</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --primary: #059669; --primary-dark: #047857;
            --surface: #ffffff; --background: #f0fdf4;
            --text-main: #064e3b; --text-muted: #64748b;
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background-color: var(--background); color: var(--text-main); }
        
        .navbar { position: fixed; top: 0; width: 100%; z-index: 50; background: rgba(255,255,255,0.9); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(0,0,0,0.05); padding: 1rem 0; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; }
        
        .details-hero { height: 60vh; min-height: 400px; position: relative; overflow: hidden; border-radius: 0 0 2.5rem 2.5rem; box-shadow: var(--shadow-lg); }
        .details-hero img { width: 100%; height: 100%; object-fit: cover; }
        .details-content { position: absolute; bottom: 0; left: 0; padding: 3rem; width: 100%; background: linear-gradient(to top, rgba(0,0,0,0.8), transparent); color: white; }
        
        .page-layout { display: grid; grid-template-columns: 1fr 360px; gap: 3rem; margin-top: 3rem; margin-bottom: 4rem; }
        
        /* Cards */
        .glass-panel { background: var(--surface); border: 1px solid #d1fae5; border-radius: 1.5rem; padding: 2rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        
        .room-card { 
            background: var(--surface); border-radius: 1.5rem; overflow: hidden; border: 1px solid #d1fae5; 
            margin-bottom: 1.5rem; transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .room-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); border-color: var(--primary); }
        .room-image { width: 100%; height: 200px; object-fit: cover; }
        .room-content { padding: 1.5rem; }
        
        .btn-primary { background: var(--primary); color: white; border: none; padding: 0.8rem 1.5rem; border-radius: 99px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.2s; display: flex; justify-content: center; align-items: center; gap: 0.5rem; }
        .btn-primary:hover { background: var(--primary-dark); }

        .sidebar-sticky { position: sticky; top: 6rem; height: fit-content; }
        
        @media (max-width: 900px) { .page-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <nav class="navbar"><div class="container" style="display:flex; justify-content:space-between;"><a href="index.html" style="text-decoration:none; color:inherit; font-weight:600; display:flex; align-items:center; gap:0.5rem;"><i data-lucide="arrow-left"></i> Back</a><span style="font-weight:800;">HostelHub</span></div></nav>

    <div class="container" style="padding-top:6rem;">
        <div class="details-hero">
            <img src="https://images.unsplash.com/photo-1584622650111-993a426fbf0a?auto=format&fit=crop&w=1200&q=80" alt="GreenLeaf Living">
            <div class="details-content">
                <h1 style="font-size:3.5rem; font-weight:800; margin-bottom:0.5rem;">GreenLeaf Living</h1>
                <p style="font-size:1.2rem; opacity:0.9; display:flex; gap:0.5rem; align-items:center;"><i data-lucide="map-pin"></i> Upper Indira Nagar, Pune</p>
            </div>
        </div>
    </div>

    <div class="container page-layout">
        <div>
            <section style="margin-bottom:3rem;">
                <h3 style="font-size:1.5rem; font-weight:700; margin-bottom:1.5rem;">Eco-Amenities</h3>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:1.5rem;">
                    <div class="glass-panel">
                        <strong style="display:block; margin-bottom:0.5rem; color:var(--primary);">Healthy Living</strong>
                        <ul style="list-style:none; color:var(--text-muted); line-height:1.6;">
                            <li>• 100% Organic Veg Meals</li>
                            <li>• Solar Heated water 24/7</li>
                            <li>• Indoor plants & purifiers</li>
                        </ul>
                    </div>
                    <div class="glass-panel">
                        <strong style="display:block; margin-bottom:0.5rem; color:var(--primary);">Eco-Transport</strong>
                        <ul style="list-style:none; color:var(--text-muted); line-height:1.6;">
                            <li>• Free bicycle parking</li>
                            <li>• Fiber Optic WiFi</li>
                            <li>• Solar backup for lights</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section style="margin-bottom:3rem;">
                <h3 style="font-size:1.5rem; font-weight:700; margin-bottom:1.5rem;">Select Room</h3>
                
                <div class="room-card">
                    <img src="https://images.unsplash.com/photo-1596276020587-8044fe049813?w=800" class="room-image" alt="Single Garden View">
                    <div class="room-content">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
                            <h4 style="font-size:1.25rem; font-weight:700;">Single Garden View</h4>
                            <span style="font-size:1.25rem; font-weight:800; color:var(--primary);">₹12,000<span style="font-size:0.8rem; color:var(--text-muted);">/mo</span></span>
                        </div>
                        <p style="color:var(--text-muted); margin-bottom:1rem;">Private room with window facing the garden.</p>
                        <button onclick="bookRoom('Single Garden View', 12000)" class="btn-primary">Book This Room <i data-lucide="arrow-right" style="width:1rem;"></i></button>
                    </div>
                </div>

                <div class="room-card">
                    <img src="https://images.unsplash.com/photo-1555854877-bab0e564b8d5?w=800" class="room-image" alt="2 Sharing Eco">
                    <div class="room-content">
                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
                            <h4 style="font-size:1.25rem; font-weight:700;">2 Sharing Eco</h4>
                            <span style="font-size:1.25rem; font-weight:800; color:var(--primary);">₹7,500<span style="font-size:0.8rem; color:var(--text-muted);">/mo</span></span>
                        </div>
                        <p style="color:var(--text-muted); margin-bottom:1rem;">Spacious sharing room with dedicated study plants.</p>
                        <button onclick="bookRoom('2 Sharing Eco', 7500)" class="btn-primary">Book This Room <i data-lucide="arrow-right" style="width:1rem;"></i></button>
                    </div>
                </div>
            </section>

            <section>
                <h3 style="font-size:1.5rem; font-weight:700; margin-bottom:1rem;">Location</h3>
                <div style="height:300px; border-radius:1.5rem; overflow:hidden; box-shadow:var(--shadow-lg);">
                   <iframe src="https://www.google.com/maps/embed?pb=!1m14!1m12!1m3!1d29446.331763935203!2d73.86865830740476!3d18.471308243219717!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!5e0!3m2!1sen!2sin!4v1768621747296!5m2!1sen!2sin" width="800" height="600" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe> width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </section>
        </div>

        <div class="sidebar-sticky">
            <div class="glass-panel" style="text-align:center; margin-bottom:1.5rem;">
                <span style="font-size:0.8rem; font-weight:700; color:var(--text-muted); letter-spacing:0.05em; text-transform:uppercase;">Live Availability</span>
                <div style="font-size:2.5rem; font-weight:800; color:var(--text-main); margin:0.5rem 0;" id="dynamic-beds">...</div>
                <div id="dynamic-status" style="display:inline-block; padding:0.25rem 0.75rem; background:#ecfdf5; border-radius:99px; font-size:0.75rem; font-weight:700;">Checking...</div>
            </div>

            <div class="glass-panel">
                <h3 style="font-size:1.1rem; font-weight:700; margin-bottom:1rem;">Contact Owner</h3>
                <div style="display:flex; flex-direction:column; gap:0.75rem;">
                    <a href="tel:+919876543210" style="display:flex; align-items:center; justify-content:center; gap:0.5rem; padding:0.8rem; background:#f1f5f9; color:var(--text-main); font-weight:600; text-decoration:none; border-radius:0.75rem; transition:0.2s;">
                        <i data-lucide="phone" style="width:1rem;"></i> Call Now
                    </a>
                    <a href="https://wa.me/919876543210" style="display:flex; align-items:center; justify-content:center; gap:0.5rem; padding:0.8rem; background:#dcfce7; color:#15803d; font-weight:600; text-decoration:none; border-radius:0.75rem; transition:0.2s;">
                        <i data-lucide="message-circle" style="width:1rem;"></i> WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="auth-check.js"></script>
    <script>
        lucide.createIcons();
        const PROPERTY_ID = "696a1b295832ab3eb80673f9"; 

        async function fetchStatus() {
            try {
                const res = await fetch(`http://localhost:5000/api/properties/${PROPERTY_ID}`);
                const data = await res.json();
                if (res.ok) {
                    let totalAvailable = 0;
                    data.roomTypes.forEach(room => totalAvailable += room.availableBeds);
                    document.getElementById("dynamic-beds").innerText = totalAvailable + " Beds";
                    const statusBadge = document.getElementById("dynamic-status");
                    if (totalAvailable > 0) {
                        statusBadge.innerText = "OPEN";
                        statusBadge.style.backgroundColor = "var(--green-600)";
                    } else {
                        statusBadge.innerText = "FULL";
                        statusBadge.style.backgroundColor = "var(--red-600)";
                    }
                }
            } catch (err) { console.error("Failed to fetch status"); }
        }
        fetchStatus();

        async function bookRoom(roomType, price) {
            const userStr = localStorage.getItem("user");
            if (!userStr) { alert("Please login first"); window.location.href = "student-login.html"; return; }
            const user = JSON.parse(userStr);
            const bookingData = { hostelId: PROPERTY_ID, roomType, price, studentId: user._id, studentName: user.name, studentEmail: user.email };
            try {
                const res = await fetch("http://localhost:5000/api/bookings", { method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(bookingData) });
                const result = await res.json();
                if (res.ok) { alert(`✅ Booking Confirmed!`); fetchStatus(); window.location.href = "my-bookings.html"; } else { alert("❌ Error: " + result.error); }
            } catch (err) { alert("Server error"); }
        }
    </script>
</body>
</html>